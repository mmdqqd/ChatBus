<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿èŠå¤©å®¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/fonts.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #messages {
            width: 80%;
            height: 400px;
            border: 1px solid #ddd;
            padding: 10px;
            overflow-y: scroll;
            display: flex;
            flex-direction: column;
            gap: 10px;

        }
        .message {
            max-width: 80%;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
        }
        .my-message {
            background-color: #DCF8C6;  /* è®¾ç½®å½“å‰ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯è‰² */
            text-align: right;  /* å³å¯¹é½ */
            align-self: flex-end;  /* å½“å‰ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºåœ¨å³è¾¹ */
        }
        .other-message {
            background-color: #FFF;  /* è®¾ç½®å…¶ä»–ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯è‰² */
            text-align: left;  /* å·¦å¯¹é½ */
            align-self: flex-start;  /* å…¶ä»–ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºåœ¨å·¦è¾¹ */
        }
        input {
            width: 80%;
            padding: 10px;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
        }
        usernameLink {
            position: relative;
            z-index: 10;  // ç¡®ä¿å®ƒåœ¨æœ€ä¸Šå±‚
        }
        /* ç§èŠæ¶ˆæ¯çš„æ ·å¼ */
        .private-message {
            background-color: #FFF9C4; /* æµ…é»„è‰²èƒŒæ™¯ */
            border-radius: 8px;         /* åœ†è§’æ•ˆæœ */
            padding: 10px;              /* å†…è¾¹è· */
            margin-bottom: 10px;        /* åº•éƒ¨é—´è· */
            max-width: 80%;             /* æœ€å¤§å®½åº¦ */
            word-wrap: break-word;      /* è‡ªåŠ¨æ¢è¡Œ */
        }

        /* å‘é€è€…çš„ç§èŠæ¶ˆæ¯ */
        .my-private-message {
            background-color: #e0ffe0;
            text-align: right;
        }


        /* å…¶ä»–æ¶ˆæ¯çš„æ ·å¼ */
        .my-message {
            background-color: #d3f8d3; /* å¯ä»¥è‡ªå®šä¹‰æˆ‘çš„æ¶ˆæ¯çš„èƒŒæ™¯é¢œè‰² */
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .other-message {
            background-color: #f1f1f1; /* å…¶ä»–ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯é¢œè‰² */
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        /* ç¡®ä¿è¡¨æƒ…é€‰æ‹©å™¨ä½äºå…¶ä»–å…ƒç´ ä¸‹æ–¹ï¼Œä½†ä¸åœ¨æœ€ä¸Šå±‚ */
        #emoji-picker {
            position: fixed;
            bottom: 10px;        /* å›ºå®šåœ¨é¡µé¢åº•éƒ¨ */
            left: 90%;
            transform: translateX(-50%);
            z-index: 10;
            display: none;       /* é»˜è®¤éšè— */
        }
        #emoji-picker-private {
            position: fixed;
            bottom: 10px;        /* å›ºå®šåœ¨é¡µé¢åº•éƒ¨ */
            left: 10%;
            transform: translateX(-50%);
            z-index: 10;
            display: none;       /* é»˜è®¤éšè— */
        }
    </style>
</head>
<body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="container">
    <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a href="" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <svg t="1735119608249" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4319" width="32" height="32"><path d="M836.992 833.092c-2.963-8.818-5.536-16.463-5.536-31.334 0-11.195 3.232-13.549 11.708-19.688 5.113-3.705 12.445-9.029 22.549-19.5 28.636-29.645 45.994-49.755 56.094-72.748 10.072-22.94 13.084-49.157 13.084-91.108 0-47.781-29.726-95.191-74.967-130.644-45.22-35.419-105.861-58.844-167.939-58.844-65.433 0-118.502 20.123-157.831 51.443-33.288 26.519-56.788 61.087-69.638 98.267-12.844 37.164-15.077 76.929-5.881 113.873 9.648 38.764 31.927 74.482 67.743 100.862 31.786 23.42 69.3 40.893 109.139 49.869 37.347 8.423 76.778 9.384 115.485 0.794 48.493-10.756 53.097-6.294 62.281 2.658 4.596 4.475 10.544 10.268 26.669 15.482-0.981-3.492-1.991-6.508-2.96-9.382z m-637.02-172.174c-2.583 7.112-5.18 14.244-6.497 24.561 11.114-3.436 20.963-9.233 30.715-14.969 19.239-11.33 38.19-22.477 66.625-16.781 22.712 4.556 39.454 7.719 57.193 9.734 16.541 1.881 34.031 2.768 58.17 2.874-6.163-15.779-8.378-34.656-7.948-53.867 0.574-25.79 5.923-52.332 12.801-72.813 18.38-54.622 41.42-75.901 76.153-107.972l1.917-1.773c4.285-3.951 6.784-6.238 9.451-8.392l-0.004-0.006c2.557-2.074 5.341-4.065 10.236-7.489 24.122-16.864 49.403-29.932 77.065-38.776 26.51-8.476 55.21-13.088 87.143-13.463-4.534-18.525-11.121-35.914-19.442-52.08-30.634-59.564-84.974-102.816-148.25-127.434-63.414-24.66-135.779-30.628-202.337-15.58-24.678 5.577-48.553 14.055-70.854 25.525-47.982 24.68-84.285 56.546-108.927 92.254-23.632 34.237-36.58 72.062-38.872 110.5-2.288 38.448 6.062 77.581 25.01 114.421 20.239 39.358 52.595 76.143 96.96 106.761l1.482 1.025V619c0.002 20.456-3.894 31.179-7.79 41.918zM71.684 543.003c-23.233-42.377-38.019-91.377-38.019-137.208 0-37.262 11.725-77.678 30.396-114.663 19.749-39.12 47.337-74.513 77.08-98.369 68.154-54.687 146.687-82.913 226.089-85.362 80.43-2.487 161.75 21.46 234.078 71.083 31.082 21.308 54.918 44.518 73.767 70.967 18.815 26.417 32.641 56.055 43.71 90.275 6.818 21.019 8.939 21.249 21.616 22.592 4.625 0.49 10.483 1.117 18.104 2.629 25.884 5.144 51.909 13.807 76.083 25.558 23.139 11.246 44.626 25.35 62.721 41.952 12.706 11.659 24.552 23.214 35.279 35.871 10.764 12.711 20.326 26.457 28.366 42.393 20.433 40.508 30.012 77.904 28.57 115.023-1.441 37.111-13.915 73.831-37.543 112.957-7.759 12.84-20.733 28.925-34.685 43.82-13.413 14.334-27.788 27.634-39.342 35.95 4.43 19.004 9.323 32.368 13.202 42.957 7.82 21.377 11.762 32.136 0.749 53.599l-1.029 2.007-2.183-0.188c-18.389-1.579-29.877-8.984-42.545-17.139l-4.193-2.687v0.008a367.028 367.028 0 0 0-18.873-11.207c-5.977-3.322-12.335-6.673-19.297-10.332-17.021-8.948-17.521-8.818-31.867-4.849-3.139 0.867-6.904 1.913-12.16 3.22-31.957 7.967-44.279 7.841-69.983 7.568-4.633-0.049-9.783-0.103-17.497-0.103-51.612 0-110.596-22.585-158.919-55.796-46.877-32.214-83.886-74.556-94.68-116.157-20.878 4.629-42.163 5.671-63.2 4.519-22.016-1.196-43.779-4.819-64.525-9.229-32.779-6.978-58.976 10.133-83.982 26.47-16.251 10.616-32.048 20.933-49.212 24.657-14.853 3.225-21.944-1.828-24.128-11.907-3.273-15.063 6.589-42.143 15.858-67.591 4.669-12.815 9.196-25.235 11.718-35.222-34.147-19.431-66.147-55.435-89.524-98.058v-0.008z m373.12-191.865c-7.582-8.671-12.687-20.77-12.687-35.727 0-8.626 6.31-17.854 15.071-24.878 8.761-7.018 20.123-11.999 30.027-11.999 23.384 0 37.988 11.018 44.371 25.248 2.536 5.64 3.758 11.81 3.709 18v0.013a45.511 45.511 0 0 1-3.904 18.083c-6.651 14.975-21.639 26.81-44.176 26.81-11.423 0-23.604-5.464-32.411-15.55z m-214.412 0.007c-7.576-8.678-12.687-20.771-12.687-35.733 0-8.626 6.31-17.854 15.077-24.878 8.754-7.018 20.117-11.999 30.027-11.999 23.099 0 37.486 10.987 43.779 25.205 2.498 5.646 3.703 11.818 3.654 17.994a46.112 46.112 0 0 1-3.849 18.073c-6.569 15.003-21.381 26.881-43.584 26.881-11.423 0-23.609-5.458-32.417-15.543zM636.29 601.132c-5.252 11.199-16.943 19.781-35.409 19.781-18.768 0-30.04-8.59-34.934-19.81l2.866-1.331-2.866 1.319c-2.015-4.625-2.923-9.705-2.809-14.799 0.114-5.063 1.258-10.165 3.302-14.83 5.406-12.318 17.184-22.028 33.797-21.755 18.441 0.293 30.638 9.933 36.053 21.999a36.387 36.387 0 0 1 3.184 14.786c0.011 5.041-1.043 10.072-3.184 14.64z m117.321 17.257c-11.773-4.742-20.697-15.774-20.697-34.358 0-16.532 8.822-26.209 20.514-30.337 4.702-1.653 9.893-2.386 15.14-2.275a51.279 51.279 0 0 1 15.385 2.719c13.878 4.719 25.154 15.336 25.154 29.894 0 16.654-11.041 28.59-24.703 33.927-4.921 1.918-10.234 2.988-15.485 3.099-5.289 0.107-10.545-0.751-15.308-2.669z" fill="#999999" p-id="4320"></path></svg>            <span class="fs-4">åœ¨çº¿èŠå¤©å®¤</span>
        </a>
        <ul class="nav nav-pills">
            <li class="nav-item"><a href="/index" class="nav-link active" aria-current="page">ä¸»é¡µ</a></li>
        </ul>
    </header>
</div>

<div id="messages" ></div>
<input type="text" id="messageInput" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." />
<button type="button" class="btn btn-light" id="emoji-btn">ğŸ˜Š</button>
<button type="submit" class="btn btn-primary" id="send" onclick="sendMessage()">å‘é€</button>
<!-- è¡¨æƒ…é€‰æ‹©å™¨ -->
<emoji-picker id="emoji-picker"></emoji-picker>
<emoji-picker id="emoji-picker-private"></emoji-picker>
<!-- ç§èŠæ¡†æ¨¡æ¿ -->
<div id="privateChatContainer" style="display: none;">
    <div id="privateChatHeader">
        <span id="privateChatUsername"></span>
        <button type="submit" class="btn btn-danger" onclick="closePrivateChat()">å…³é—­</button>
    </div>
    <div id="privateMessages"></div>
    <input type="text" id="privateMessageInput" placeholder="è¯·è¾“å…¥ç§èŠæ¶ˆæ¯..." />
    <button type="button" class="btn btn-light" id="emoji-btn-private">ğŸ˜Š</button>
    <button type="submit" class="btn btn-primary" onclick="sendPrivateMessage()">å‘é€ç§èŠæ¶ˆæ¯</button>
</div>
<script>
    document.getElementById('emoji-btn-private').addEventListener('click', function() {
        var emojiPicker = document.getElementById('emoji-picker-private');
        if (emojiPicker.style.display === 'none') {
            emojiPicker.style.display = 'block'; // å¦‚æœæ˜¯éšè—çŠ¶æ€ï¼Œåˆ™æ˜¾ç¤º
        } else {
            emojiPicker.style.display = 'none'; // å¦åˆ™éšè—
        }
    });
</script>
<script>
    document.getElementById('emoji-btn').addEventListener('click', function() {
        var emojiPicker = document.getElementById('emoji-picker');
        if (emojiPicker.style.display === 'none') {
            emojiPicker.style.display = 'block'; // å¦‚æœæ˜¯éšè—çŠ¶æ€ï¼Œåˆ™æ˜¾ç¤º
        } else {
            emojiPicker.style.display = 'none'; // å¦åˆ™éšè—
        }
    });
</script>
<script>
    let currentUser = '';  // å½“å‰ç”¨æˆ·å
    let userRole = '';     // ç”¨æˆ·è§’è‰²
    let socket;            // WebSocket è¿æ¥å˜é‡
    let privateReceiver = ''; // å½“å‰ç§èŠæ¥æ”¶è€…

    // è·å–å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œè§’è‰²ï¼Œå¹¶åˆå§‹åŒ– WebSocket è¿æ¥
    $(document).ready(function () {
        $.ajax({
            url: '/role',  // å‡è®¾è¿™æ˜¯è·å–å½“å‰ç”¨æˆ·åçš„æ¥å£
            method: "GET",
            success: function (data) {
                currentUser = data.username;  // ä¿å­˜å½“å‰ç”¨æˆ·å
                userRole = data.role;         // ä¿å­˜ç”¨æˆ·è§’è‰²

                // åˆå§‹åŒ– WebSocket è¿æ¥
                socket = new WebSocket('ws://localhost:8080/chat1?username=' + currentUser);

                // ç›‘å¬ WebSocket æ¶ˆæ¯
                socket.onmessage = function(event) {
                    const messagesDiv = document.getElementById('messages');
                    const messageData = JSON.parse(event.data);  // è§£ææ¶ˆæ¯æ•°æ®
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('message');

                        // messageElement.textContent = messageData.username + ": " + messageData.message;
                    // ä¸ºæ•´ä¸ªæ¶ˆæ¯åŒºåŸŸæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»æ—¶æ‰“å¼€ç§èŠæ¡†
                    messageElement.onclick = function() {
                        openPrivateChat(messageData.username);  // ç‚¹å‡»æ¶ˆæ¯æ—¶æ‰“å¼€ç§èŠæ¡†
                    };

                    // // å°†æ¶ˆæ¯å…ƒç´ æ·»åŠ åˆ°èŠå¤©å®¹å™¨ä¸­
                    // messagesDiv.appendChild(messageElement);
                    // åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦ä¸ºç§èŠæ¶ˆæ¯
                    if (messageData.receiver) {
                        // å¦‚æœæ˜¯ç§èŠæ¶ˆæ¯ï¼Œä¸”å½“å‰ç”¨æˆ·æ˜¯æ¥æ”¶è€…ï¼Œæ‰æ˜¾ç¤º
                        if (messageData.receiver === currentUser) {
                            messageElement.classList.add('private-message');
                            messageElement.textContent = messageData.username + " (ç§èŠ): " + messageData.message;
                            messagesDiv.appendChild(messageElement);
                        }

                        // å¦‚æœæ˜¯å‘é€è€…ï¼Œè‡ªå·±ä¹Ÿèƒ½çœ‹åˆ°ç§èŠæ¶ˆæ¯
                        if (messageData.username === currentUser) {
                            messageElement.classList.add('my-private-message');  // è‡ªå·±å‘é€çš„ç§èŠæ¶ˆæ¯çš„æ ·å¼
                            messageElement.textContent = messageData.username + " (ç§èŠ): " + messageData.message;
                            messagesDiv.appendChild(messageElement);
                        }
                    } else {
                        // å…¬å…±æ¶ˆæ¯
                        if (messageData.username === currentUser) {
                            messageElement.classList.add('my-message');
                        } else {
                            messageElement.classList.add('other-message');
                        }
                        messageElement.textContent = messageData.username + ": " + messageData.message;
                        messagesDiv.appendChild(messageElement);
                    }

                    messagesDiv.scrollTop = messagesDiv.scrollHeight;  // å§‹ç»ˆæ»šåŠ¨åˆ°åº•éƒ¨
                };

            },
            error: function () {
                alert("Error fetching user data!");
            }
        });
    });

    // å½“ç”¨æˆ·é€‰æ‹©è¡¨æƒ…æ—¶ï¼Œæ’å…¥åˆ°è¾“å…¥æ¡†
    document.getElementById('emoji-picker').addEventListener('emoji-click', (event) => {
        const emoji = event.detail.unicode;
        const messageInput = document.getElementById('messageInput');
        messageInput.value += emoji;  // å°†è¡¨æƒ…æ·»åŠ åˆ°è¾“å…¥æ¡†
    });

    // å‘é€å…¬å…±æ¶ˆæ¯
    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();

        if (message && currentUser) {
            const messageData = {
                username: currentUser,
                message: message,
                receiver: null  // null è¡¨ç¤ºå¹¿æ’­æ¶ˆæ¯
            };

            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(messageData)); // é€šè¿‡ WebSocket å‘é€æ¶ˆæ¯
                messageInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
            } else {
                alert("WebSocket æœªè¿æ¥æˆ–å·²å…³é—­ï¼");
            }
        } else {
            alert("è¯·è¾“å…¥æ¶ˆæ¯æˆ–ç¡®ä¿å·²è·å–ç”¨æˆ·åï¼");
        }
    }

    // æ‰“å¼€ç§èŠæ¡†
    function openPrivateChat(username) {
        console.log("æ‰“å¼€ç§èŠæ¡†ï¼Œæ¥æ”¶è€…:", username);  // è°ƒè¯•æ—¥å¿—
        privateReceiver = username;
        document.getElementById('privateChatUsername').textContent = 'æ­£åœ¨ä¸ ' + username + ' ç§èŠ';
        document.getElementById('privateChatContainer').style.display = 'block';
        document.getElementById('messageInput').style.display = 'none';
        document.getElementById('emoji-btn').style.display = 'none';
        document.getElementById('send').style.display = 'none';
        loadPrivateMessages(username);
    }

    // å…³é—­ç§èŠæ¡†
    function closePrivateChat() {
        document.getElementById('privateChatContainer').style.display = 'none';
        document.getElementById('messageInput').style.display = 'block';
        document.getElementById('emoji-btn').style.display = 'block';
        document.getElementById('send').style.display = 'block';
    }

    // åŠ è½½ç§èŠæ¶ˆæ¯
    function loadPrivateMessages(username) {
        // è¿™é‡Œå¯ä»¥åŠ è½½å†å²ç§èŠæ¶ˆæ¯ï¼Œæˆ–è€…æ ¹æ®éœ€è¦ç›´æ¥å‘é€åˆ° WebSocket
        const privateMessagesDiv = document.getElementById('privateMessages');
        privateMessagesDiv.innerHTML = ''; // æ¸…ç©ºæ—§çš„æ¶ˆæ¯
        // å‡è®¾æ­¤æ—¶æˆ‘ä»¬æ²¡æœ‰å†å²è®°å½•ï¼Œä½ å¯ä»¥ä»æ•°æ®åº“æˆ– WebSocket è·å–è¿™äº›æ¶ˆæ¯
    }



    // å½“ç”¨æˆ·é€‰æ‹©è¡¨æƒ…æ—¶ï¼Œæ’å…¥åˆ°ç§èŠè¾“å…¥æ¡†
    document.getElementById('emoji-picker-private').addEventListener('emoji-click', (event) => {
        const emoji = event.detail.unicode;
        const privateMessageInput = document.getElementById('privateMessageInput');
        privateMessageInput.value += emoji;  // å°†è¡¨æƒ…æ·»åŠ åˆ°è¾“å…¥æ¡†
    });

    // å‘é€ç§èŠæ¶ˆæ¯
    function sendPrivateMessage() {
        const privateMessageInput = document.getElementById('privateMessageInput');
        const message = privateMessageInput.value.trim();

        if (message && privateReceiver) {
            const messageData = {
                username: currentUser,
                message: ' æ­£åœ¨å’Œä½ è¯´æ‚„æ‚„è¯: ' + message,  // æ¶ˆæ¯å†…å®¹å·²åŒ…å«æç¤º
                receiver: privateReceiver // ç§èŠæ¶ˆæ¯çš„æ¥æ”¶è€…
            };

            // åœ¨å½“å‰ç”¨æˆ·çš„ç§èŠæ¡†ä¸­æ˜¾ç¤ºè‡ªå·±çš„æ¶ˆæ¯
            displayPrivateMessage(currentUser, messageData.message, 'my-private-message');

            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(messageData)); // é€šè¿‡ WebSocket å‘é€ç§èŠæ¶ˆæ¯
                privateMessageInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                loadPrivateMessages(privateReceiver); // åŠ è½½æœ€æ–°çš„ç§èŠæ¶ˆæ¯

            } else {
                alert("åœ¨çº¿èŠå¤©å®¤ æœªè¿æ¥æˆ–å·²å…³é—­ï¼");
            }
        } else {
            alert("è¯·è¾“å…¥ç§èŠæ¶ˆæ¯ï¼");
        }
    }
    // åœ¨ç§èŠæ¶ˆæ¯æ¡†ä¸­æ˜¾ç¤ºæ¶ˆæ¯
    function displayPrivateMessage(username, message, messageClass) {
        const privateMessagesDiv = document.getElementById('privateMessages');
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', messageClass); // æ·»åŠ æ ·å¼ç±»ï¼ŒåŒºåˆ†å‘é€è€…å’Œæ¥æ”¶è€…

        // æ„å»ºæ¶ˆæ¯å†…å®¹
        messageElement.textContent = username + ": " + message;

        // å°†æ¶ˆæ¯å…ƒç´ æ·»åŠ åˆ°ç§èŠæ¶ˆæ¯åŒºåŸŸ
        privateMessagesDiv.appendChild(messageElement);

        // å§‹ç»ˆæ»šåŠ¨åˆ°åº•éƒ¨
        privateMessagesDiv.scrollTop = privateMessagesDiv.scrollHeight;
    }
</script>

</body>
</html>






<!--<!DOCTYPE html>-->
<!--<html lang="zh">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>WebSocket èŠå¤©</title>-->
<!--    <style>/* ä¿ç•™åŸæ ·å¼ï¼Œç¡®ä¿ç°æœ‰å¸ƒå±€ä¸å—å½±å“ */-->
<!--    body {-->
<!--        font-family: Arial, sans-serif;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        justify-content: center;-->
<!--        align-items: center;-->
<!--        height: 100vh;-->
<!--        margin: 0;-->
<!--    }-->

<!--    /* #messages: ä¿ç•™ä½ çš„æ ·å¼ï¼Œå¹¶åˆå¹¶æ–°çš„é«˜åº¦ã€æ»šåŠ¨æ ·å¼ */-->
<!--    #messages {-->
<!--        width: 80%;-->
<!--        height: 400px;-->
<!--        border: 1px solid #ddd;-->
<!--        padding: 10px;-->
<!--        overflow-y: scroll;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 10px;-->
<!--        max-height: 300px; /* æ–°æ ·å¼çš„max-height */-->
<!--    }-->

<!--    /* .message: ä¿æŒä¸€è‡´æ€§ */-->
<!--    .message {-->
<!--        max-width: 80%;-->
<!--        padding: 10px;-->
<!--        border-radius: 10px;-->
<!--        display: inline-block;-->
<!--        margin: 5px 0; /* æ–°æ ·å¼çš„margin */-->
<!--    }-->

<!--    /* å¯¹æ¯”è‡ªå®šä¹‰çš„ç”¨æˆ·æ¶ˆæ¯å’Œå…¶ä»–ç”¨æˆ·æ¶ˆæ¯ */-->
<!--    .my-message {-->
<!--        background-color: #DCF8C6;  /* è®¾ç½®å½“å‰ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯è‰² */-->
<!--        text-align: right;  /* å³å¯¹é½ */-->
<!--        align-self: flex-end;  /* å½“å‰ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºåœ¨å³è¾¹ */-->
<!--        background-color: #d3f8d3; /* å¯ä»¥è‡ªå®šä¹‰æˆ‘çš„æ¶ˆæ¯çš„èƒŒæ™¯é¢œè‰² */-->
<!--        border-radius: 8px;-->
<!--        padding: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .other-message {-->
<!--        background-color: #FFF;  /* è®¾ç½®å…¶ä»–ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯è‰² */-->
<!--        text-align: left;  /* å·¦å¯¹é½ */-->
<!--        align-self: flex-start;  /* å…¶ä»–ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºåœ¨å·¦è¾¹ */-->
<!--        background-color: #f1f1f1; /* å…¶ä»–ç”¨æˆ·æ¶ˆæ¯çš„èƒŒæ™¯é¢œè‰² */-->
<!--        border-radius: 8px;-->
<!--        padding: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    /* ç§èŠæ¶ˆæ¯çš„æ ·å¼ */-->
<!--    .private-message {-->
<!--        background-color: #FFF9C4; /* æµ…é»„è‰²èƒŒæ™¯ */-->
<!--        border-radius: 8px;         /* åœ†è§’æ•ˆæœ */-->
<!--        padding: 10px;              /* å†…è¾¹è· */-->
<!--        margin-bottom: 10px;        /* åº•éƒ¨é—´è· */-->
<!--        max-width: 80%;             /* æœ€å¤§å®½åº¦ */-->
<!--        word-wrap: break-word;      /* è‡ªåŠ¨æ¢è¡Œ */-->
<!--    }-->

<!--    /* è¾“å…¥æ¡†å’ŒæŒ‰é’®æ ·å¼ */-->
<!--    input {-->
<!--        width: 80%;-->
<!--        padding: 10px;-->
<!--        margin-top: 10px;-->
<!--    }-->

<!--    button {-->
<!--        padding: 10px 20px;-->
<!--        margin-top: 10px;-->
<!--    }-->

<!--    /* å¤„ç†ç§èŠå®¹å™¨ (#privateChatContainer) å’Œè¡¨æƒ…é€‰æ‹©å™¨ (#emoji-picker) */-->
<!--    #privateChatContainer {-->
<!--        display: none;-->
<!--        margin-top: 20px;-->
<!--        padding: 10px;-->
<!--        border: 1px solid #ccc;-->
<!--    }-->

<!--    #privateMessages {-->
<!--        max-height: 200px;-->
<!--        overflow-y: auto;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    /* ç¡®ä¿è¡¨æƒ…é€‰æ‹©å™¨ä½äºå…¶ä»–å…ƒç´ ä¸‹æ–¹ï¼Œä½†ä¸åœ¨æœ€ä¸Šå±‚ */-->
<!--    #emoji-picker {-->
<!--      -->
<!--        z-index: 10;           /* è®¾ç½®è¾ƒä½çš„ z-indexï¼Œç¡®ä¿å®ƒä½äºå…¶ä»–åŠŸèƒ½çš„ä¸‹æ–¹ */-->
<!--        bottom: 50px;          /* è®©è¡¨æƒ…é€‰æ‹©å™¨è·ç¦»åº•éƒ¨ä¸€å®šè·ç¦»ï¼ˆæ ¹æ®éœ€è¦è°ƒæ•´ï¼‰ */-->
<!--    }-->

<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div>-->
<!--    <div id="messages"></div>-->
<!--    <input type="text" id="messageInput" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." />-->
<!--    <button type="button" class="btn btn-light" id="emoji-btn">ğŸ˜Š</button>-->
<!--    <button type="submit" class="btn btn-primary" onclick="sendMessage()">å‘é€</button>-->
<!--</div>-->

<!--&lt;!&ndash; ç§èŠæ¡†æ¨¡æ¿ &ndash;&gt;-->
<!--<div id="privateChatContainer">-->
<!--    <div id="privateChatHeader">-->
<!--        <span id="privateChatUsername"></span>-->
<!--        <button type="submit" class="btn btn-danger" onclick="closePrivateChat()">å…³é—­</button>-->
<!--    </div>-->
<!--    <div id="privateMessages"></div>-->
<!--    <input type="text" id="privateMessageInput" placeholder="è¯·è¾“å…¥ç§èŠæ¶ˆæ¯..." />-->
<!--    <button type="submit" class="btn btn-primary" onclick="sendPrivateMessage()">å‘é€ç§èŠæ¶ˆæ¯</button>-->
<!--</div>-->

<!--&lt;!&ndash; è¡¨æƒ…é€‰æ‹©å™¨ &ndash;&gt;-->
<!--<emoji-picker id="emoji-picker"></emoji-picker>-->

<!--<script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>-->
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->

<!--<script>-->
<!--    let currentUser = '';  // å½“å‰ç”¨æˆ·å-->
<!--    let userRole = '';     // ç”¨æˆ·è§’è‰²-->
<!--    let socket;            // WebSocket è¿æ¥å˜é‡-->
<!--    let privateReceiver = ''; // å½“å‰ç§èŠæ¥æ”¶è€…-->

<!--    // è·å–å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œè§’è‰²ï¼Œå¹¶åˆå§‹åŒ– WebSocket è¿æ¥-->
<!--    $(document).ready(function () {-->
<!--        $.ajax({-->
<!--            url: '/role',  // å‡è®¾è¿™æ˜¯è·å–å½“å‰ç”¨æˆ·åçš„æ¥å£-->
<!--            method: "GET",-->
<!--            success: function (data) {-->
<!--                currentUser = data.username;  // ä¿å­˜å½“å‰ç”¨æˆ·å-->
<!--                userRole = data.role;         // ä¿å­˜ç”¨æˆ·è§’è‰²-->

<!--                // åˆå§‹åŒ– WebSocket è¿æ¥-->
<!--                socket = new WebSocket('ws://localhost:8080/chat1?username=' + currentUser);-->

<!--                // ç›‘å¬ WebSocket æ¶ˆæ¯-->
<!--                socket.onmessage = function(event) {-->
<!--                    const messagesDiv = document.getElementById('messages');-->
<!--                    const messageData = JSON.parse(event.data);  // è§£ææ¶ˆæ¯æ•°æ®-->
<!--                    const messageElement = document.createElement('div');-->
<!--                    messageElement.classList.add('message');-->

<!--                    // åˆ¤æ–­æ¶ˆæ¯çš„å‘é€è€…ï¼Œå¹¶è®¾ç½®æ˜¾ç¤ºä½ç½®-->
<!--                    if (messageData.username === currentUser) {-->
<!--                        messageElement.classList.add('my-message');-->
<!--                    } else {-->
<!--                        messageElement.classList.add('other-message');-->
<!--                    }-->

<!--                    // æ˜¾ç¤ºæ¶ˆæ¯å’Œè¡¨æƒ…-->
<!--                    messageElement.innerHTML = messageData.username + ": " + parseEmojis(messageData.message);-->

<!--                    // ä¸ºæ•´ä¸ªæ¶ˆæ¯åŒºåŸŸæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»æ—¶æ‰“å¼€ç§èŠæ¡†-->
<!--                    messageElement.onclick = function() {-->
<!--                        openPrivateChat(messageData.username);  // ç‚¹å‡»æ¶ˆæ¯æ—¶æ‰“å¼€ç§èŠæ¡†-->
<!--                    };-->

<!--                    // å°†æ¶ˆæ¯å…ƒç´ æ·»åŠ åˆ°èŠå¤©å®¹å™¨ä¸­-->
<!--                    messagesDiv.appendChild(messageElement);-->
<!--                    messagesDiv.scrollTop = messagesDiv.scrollHeight;  // å§‹ç»ˆæ»šåŠ¨åˆ°åº•éƒ¨-->
<!--                };-->
<!--            },-->
<!--            error: function () {-->
<!--                alert("Error fetching user data!");-->
<!--            }-->
<!--        });-->
<!--    });-->

<!--    // è§£æè¡¨æƒ…å­—ç¬¦-->
<!--    function parseEmojis(message) {-->
<!--        // è¿™é‡Œç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«å’Œè½¬æ¢è¡¨æƒ…å­—ç¬¦-->
<!--        const emojiMap = {-->
<!--            ':)': 'ğŸ˜Š',-->
<!--            ':(': 'â˜¹ï¸',-->
<!--            ':P': 'ğŸ˜œ',-->
<!--            ':-)': 'ğŸ˜Š',-->
<!--            ':-(': 'â˜¹ï¸',-->
<!--            ';-)': 'ğŸ˜‰',-->
<!--            ':D': 'ğŸ˜€',-->
<!--            ':love:': 'â¤ï¸',-->
<!--            // ä½ å¯ä»¥æ ¹æ®éœ€æ±‚æ·»åŠ æ›´å¤šè¡¨æƒ…-->
<!--        };-->

<!--        // æ›¿æ¢æ¶ˆæ¯ä¸­çš„è¡¨æƒ…å­—ç¬¦-->
<!--        return message.replace(/(:\)|:\(|:P|:-\)|:-\(|;-\)|:D|:love:)/g, match => emojiMap[match] || match);-->
<!--    }-->

<!--    // æ˜¾ç¤ºè¡¨æƒ…é€‰æ‹©å™¨-->
<!--    document.getElementById('emoji-btn').addEventListener('click', () => {-->
<!--        const emojiPicker = document.getElementById('emoji-picker');-->
<!--        emojiPicker.style.display = emojiPicker.style.display === 'none' ? 'block' : 'none'; // Toggle emoji picker visibility-->
<!--    });-->

<!--    // å½“ç”¨æˆ·é€‰æ‹©è¡¨æƒ…æ—¶ï¼Œæ’å…¥åˆ°è¾“å…¥æ¡†-->
<!--    document.getElementById('emoji-picker').addEventListener('emoji-click', (event) => {-->
<!--        const emoji = event.detail.unicode;-->
<!--        const messageInput = document.getElementById('messageInput');-->
<!--        messageInput.value += emoji;  // å°†è¡¨æƒ…æ·»åŠ åˆ°è¾“å…¥æ¡†-->
<!--    });-->

<!--    // å‘é€å…¬å…±æ¶ˆæ¯-->
<!--    function sendMessage() {-->
<!--        const messageInput = document.getElementById('messageInput');-->
<!--        const message = messageInput.value.trim();-->

<!--        if (message && currentUser) {-->
<!--            const messageData = {-->
<!--                username: currentUser,-->
<!--                message: message, // åŒ…å«è¡¨æƒ…ç¬¦å·çš„æ¶ˆæ¯-->
<!--                receiver: null  // null è¡¨ç¤ºå¹¿æ’­æ¶ˆæ¯-->
<!--            };-->

<!--            if (socket && socket.readyState === WebSocket.OPEN) {-->
<!--                socket.send(JSON.stringify(messageData)); // é€šè¿‡ WebSocket å‘é€æ¶ˆæ¯-->
<!--                messageInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†-->
<!--            } else {-->
<!--                alert("WebSocket æœªè¿æ¥æˆ–å·²å…³é—­ï¼");-->
<!--            }-->
<!--        } else {-->
<!--            alert("è¯·è¾“å…¥æ¶ˆæ¯æˆ–ç¡®ä¿å·²è·å–ç”¨æˆ·åï¼");-->
<!--        }-->
<!--    }-->

<!--    // æ‰“å¼€ç§èŠæ¡†-->
<!--    function openPrivateChat(username) {-->
<!--        privateReceiver = username;-->
<!--        document.getElementById('privateChatUsername').textContent = 'æ­£åœ¨ä¸ ' + username + ' ç§èŠ';-->
<!--        document.getElementById('privateChatContainer').style.display = 'block';-->
<!--        document.getElementById('messageInput').style.display = 'none';-->

<!--        loadPrivateMessages(username);-->
<!--    }-->

<!--    // å…³é—­ç§èŠæ¡†-->
<!--    function closePrivateChat() {-->
<!--        document.getElementById('privateChatContainer').style.display = 'none';-->
<!--    }-->

<!--    // åŠ è½½ç§èŠæ¶ˆæ¯-->
<!--    function loadPrivateMessages(username) {-->
<!--        // è¿™é‡Œå¯ä»¥åŠ è½½å†å²ç§èŠæ¶ˆæ¯ï¼Œæˆ–è€…æ ¹æ®éœ€è¦ç›´æ¥å‘é€åˆ° WebSocket-->
<!--        const privateMessagesDiv = document.getElementById('privateMessages');-->
<!--        privateMessagesDiv.innerHTML = ''; // æ¸…ç©ºæ—§çš„æ¶ˆæ¯-->
<!--    }-->

<!--    // å‘é€ç§èŠæ¶ˆæ¯-->
<!--    function sendPrivateMessage() {-->
<!--        const privateMessageInput = document.getElementById('privateMessageInput');-->
<!--        const message = privateMessageInput.value.trim();-->

<!--        if (message && privateReceiver) {-->
<!--            const messageData = {-->
<!--                username: currentUser,-->
<!--                message: ' æ­£åœ¨å’Œä½ è¯´æ‚„æ‚„è¯: ' + message,  // æ¶ˆæ¯å†…å®¹å·²åŒ…å«æç¤º-->
<!--                receiver: privateReceiver // ç§èŠæ¶ˆæ¯çš„æ¥æ”¶è€…-->
<!--            };-->

<!--            if (socket && socket.readyState === WebSocket.OPEN) {-->
<!--                socket.send(JSON.stringify(messageData)); // é€šè¿‡ WebSocket å‘é€ç§èŠæ¶ˆæ¯-->
<!--                privateMessageInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†-->
<!--                loadPrivateMessages(privateReceiver); // åŠ è½½æœ€æ–°çš„ç§èŠæ¶ˆæ¯-->
<!--            } else {-->
<!--                alert("åœ¨çº¿èŠå¤©å®¤ æœªè¿æ¥æˆ–å·²å…³é—­ï¼");-->
<!--            }-->
<!--        } else {-->
<!--            alert("è¯·è¾“å…¥ç§èŠæ¶ˆæ¯ï¼");-->
<!--        }-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->
